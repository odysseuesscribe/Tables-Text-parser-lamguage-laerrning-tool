<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Language Learner</title>
  <style>
    table, td { border: 1px solid #ccc; border-collapse: collapse; padding: 4px; }
    .hidden { display: none; }
    .highlight { background-color: yellow; }
    #flashcardScreen { 
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background: white; display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      font-size: 2em; z-index: 9999;
    }
    #flashcardScreen button { font-size: 1em; margin: 10px; padding: 10px; }
  </style>
</head>
<body>

<h1>Language Learning App</h1>

<!-- Day Selector -->
<select id="daySelector"></select>
<button onclick="showSelectedDay()">Show Day</button>

<!-- Reader Controls -->
<div>
  <label>Read from col: <input type="number" id="readFrom" value="1" min="1"></label>
  <label>to col: <input type="number" id="readTo" value="2" min="1"></label>
  <label>Repeat row: <input type="number" id="repeatRow" value="1" min="1"></label>
  <button onclick="startReading()">‚ñ∂ Play</button>
  <button onclick="pauseReading()">‚è∏ Pause</button>
  <button onclick="resumeReading()">‚ñ∂ Resume</button>
</div>

<!-- Placeholder for 90 tables -->
<div id="tablesContainer"></div>

<!-- Placeholder for Flashcard Screen -->
<div id="flashcardScreen" class="hidden">
  <div id="flashcardWord"></div>
  <button onclick="markKnown(true)">I know</button>
  <button onclick="markKnown(false)">No</button>
</div>

<!-- Paste your plaintext into this hidden element -->
<pre id="wordlist" class="hidden">
<!-- EXAMPLE FORMAT -->
Que   that   or what
Gracias   thanks   or graces
Tu   you   'not formal pronoun'
... (up to 2000 lines)
</pre>

<script>
let wordData = [];
let currentDay = 0;
let flashcardWords = [], flashIndex = 0, known = [], unknown = [];
let synth = window.speechSynthesis;
let isPaused = false;

// Parse and organize
function splitIntoDays() {
  const raw = document.getElementById("wordlist").innerText.trim().split("\n");
  const totalLines = raw.length;
  const linesPerDay = Math.ceil(totalLines / 90);
  for (let i = 0; i < 90; i++) {
    let start = i * linesPerDay;
    let end = start + linesPerDay;
    let group = raw.slice(start, end).map(line => line.split(/\s{2,}|\t+/));
    wordData.push(group);
  }
}

function createTables() {
  let container = document.getElementById("tablesContainer");
  for (let i = 0; i < 90; i++) {
    let table = document.createElement("table");
    table.id = `day${i+1}`;
    table.classList.add("hidden");
    wordData[i].forEach((cols, idx) => {
      let row = table.insertRow();
      cols.forEach((word, cidx) => {
        let cell = row.insertCell();
        cell.innerText = word;
        cell.dataset.row = idx;
        cell.dataset.col = cidx;
      });
      let btn = row.insertCell();
      btn.innerHTML = `<button onclick="startFlashcard(${i}, ${idx})">üÉè</button>`;
    });
    container.appendChild(table);
  }
  // Fill selector
  let selector = document.getElementById("daySelector");
  for (let i = 1; i <= 90; i++) {
    let opt = document.createElement("option");
    opt.value = i;
    opt.text = `Day ${i}`;
    selector.appendChild(opt);
  }
}

function showSelectedDay() {
  let sel = parseInt(document.getElementById("daySelector").value);
  document.querySelectorAll("table").forEach(t => t.classList.add("hidden"));
  document.getElementById(`day${sel}`).classList.remove("hidden");
  currentDay = sel - 1;
}

function startFlashcard(day, rowIdx) {
  flashcardWords = [wordData[day][rowIdx].slice(0,2)];
  flashIndex = 0;
  known = [];
  unknown = [];
  document.getElementById("flashcardScreen").classList.remove("hidden");
  showFlashcard();
}

function showFlashcard() {
  let [foreign, trans] = flashcardWords[flashIndex];
  document.getElementById("flashcardWord").innerText = foreign;
}

function markKnown(isKnown) {
  let row = flashcardWords[flashIndex];
  if (isKnown) known.push(row);
  else unknown.push(row);
  flashIndex++;
  if (flashIndex >= flashcardWords.length) {
    document.getElementById("flashcardScreen").classList.add("hidden");
    alert(`Known: ${known.length}, Unknown: ${unknown.length}`);
    rebuildTableWithUnknowns();
  } else {
    showFlashcard();
  }
}

function rebuildTableWithUnknowns() {
  let table = document.getElementById(`day${currentDay + 1}`);
  for (let r = table.rows.length - 1; r >= 0; r--) {
    let cell = table.rows[r].cells[0]?.innerText;
    if (!unknown.find(u => u[0] === cell)) {
      table.deleteRow(r);
    }
  }
}

function startReading() {
  isPaused = false;
  let from = parseInt(document.getElementById("readFrom").value) - 1;
  let to = parseInt(document.getElementById("readTo").value) - 1;
  let repeat = parseInt(document.getElementById("repeatRow").value);
  let table = document.getElementById(`day${currentDay + 1}`);
  let rows = Array.from(table.rows);
  let i = 0;

  function readRow() {
    if (i >= rows.length || isPaused) return;
    let cells = rows[i].cells;
    for (let c = 0; c < cells.length; c++) cells[c].classList.remove("highlight");
    let words = [];
    for (let j = from; j <= to; j++) {
      if (cells[j]) {
        words.push(cells[j].innerText);
        cells[j].classList.add("highlight");
      }
    }
    let utter = new SpeechSynthesisUtterance(words.join(" "));
    utter.onend = () => {
      if (--repeat > 0) {
        synth.speak(utter);
      } else {
        i++;
        repeat = parseInt(document.getElementById("repeatRow").value);
        readRow();
      }
    };
    synth.speak(utter);
  }

  readRow();
}

function pauseReading() {
  isPaused = true;
  synth.pause();
}

function resumeReading() {
  isPaused = false;
  synth.resume();
}

splitIntoDays();
createTables();
</script>
</body>
</html>
